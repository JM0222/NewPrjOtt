<template>
    <div>
        <a href="/">로고&emsp;</a>
        <a href="/review">리뷰&emsp;</a>
        <a href="/board">게시판&emsp;</a>
        <a href="/board2">함께봐요&emsp;</a>
        <a href="/rank">실시간 검색순위&emsp;</a>
        <a href="/token">토큰체크페이지&emsp;</a>
        <button v-if="$store.state.token" @click="logOut">로그아웃&emsp;</button>
        <br>
        <p>테스트 :: {{authEmail}}, {{authName}}</p>
        <a v-if="authName" href="/auth/logout">로그아웃</a>
        <p v-else>로그인해</p>

        <!-- 로그인 다이얼로그 -->
        <v-btn color="warning" fab dark @click="mdUp">
            <v-icon>mdi-account-circle</v-icon>
            
            <v-dialog v-model="dialog" persistent max-width="500px">
                <v-card>
                    <v-card-title>
                    <span class="headline">로그인</span>
                    </v-card-title>
                    <v-card-text>
                    <validation-observer>
                    <v-form>
                        <v-container fluid>
                        <v-row>
                            <v-col cols="12" sm="6">
                            <validation-provider
                                v-slot="{errors}"
                                name="이메일"
                                :rules="{
                                    required:true,
                                    email:true,
                                    }">
                                <v-text-field
                                    v-model="email"
                                    label="E-mail"
                                    :error-messages="errors"
                                ></v-text-field>
                            </validation-provider>
                            </v-col>
                            <v-col cols="12" sm="6">
                            <validation-provider
                                v-slot="{errors}"
                                name="비밀번호"
                                :rules="{
                                    required:true,
                                    min:8,
                                    }"
                            >
                            <v-text-field
                                v-model="password"
                                :append-icon="show1 ? 'mdi-eye' : 'mdi-eye-off'"
                                :type="show1 ? 'text' : 'password'"
                                name="input-10-1"
                                label="Password"
                                :counter=8
                                @click:append="show1 = !show1"
                                :error-messages="errors"
                            ></v-text-field>
                            </validation-provider>
                            </v-col>
                        </v-row>
                        </v-container>
                        <v-checkbox
                            v-model="remember"
                            label="로그인 유지"
                        ></v-checkbox>
                    </v-form>
                    </validation-observer>
                    <v-col>
                        <a href="/auth/kakao" alt="kakao login">
                            <img alt="kakao logo" src="../assets/kakao_login_medium_wide.png" />
                        </a>
                        <a href="/auth/naver" alt="naver login">
                            <img alt="naver logo" src="../assets/naver_login.png" />
                        </a>
                    </v-col>
                    </v-card-text>
                    <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn color="primary" @click="mdUp2">회원가입</v-btn>
                    <v-btn color="primary" @click="postLoginData">로그인</v-btn>
                    <v-btn color="primary" @click.native="dialog = false">닫기</v-btn>
                    </v-card-actions>
                </v-card>
            </v-dialog>

            <!-- 회원가입 다이얼로그 -->
            <v-dialog v-model="dialog2" width="500">
            <v-card>
                <v-card-title class="text-h5 grey lighten-2">
                회원가입
                </v-card-title>

                <br>
                <v-card-text>
                <validation-observer
                    ref="observer"
                    v-slot="{ invalid }"
                >
                <v-form @submit.prevent="postData">
                    <!-- 닉네임 -->
                    <validation-provider
                        v-slot="{errors}"
                        name="닉네임"
                        :rules="{
                            required:true,
                            max:8,
                            }"
                    >
                    <v-text-field v-model="name" :counter="8" label="NickName" :error-messages="errors"></v-text-field>
                    </validation-provider>
                    <!-- 이메일 -->
                    <validation-provider
                        v-slot="{errors}"
                        name="이메일"
                        :rules="{
                            required:true,
                            email:true,
                            }"
                    >
                    <v-text-field v-model="joinEmail" label="E-mail" :error-messages="errors"></v-text-field>
                    </validation-provider>
                    <!-- 비밀번호 & 비밀번호 확인 -->
                    <validation-provider
                        v-slot="{errors}"
                        name="비밀번호"
                        :rules="{
                            required:true,
                            min:8,
                            }"
                    >
                    <v-text-field v-model="joinPassword"
                            :append-icon="show1 ? 'mdi-eye' : 'mdi-eye-off'"
                            :type="show1 ? 'text' : 'password'"
                            name="input-10-1"
                            label="비밀번호"
                            counter
                            @click:append="show1 = !show1"
                            :error-messages="errors"
                    ></v-text-field>
                    </validation-provider>
                    <!--비밀번호 일치 Validation -->
                    <validation-provider
                        v-slot="{errors}"
                        name="비밀번호확인"
                        :rules="{
                            required:true,
                            confirmed:'비밀번호'
                            }"
                    >
                    <v-text-field v-model="checkPassword"
                            :append-icon="show1 ? 'mdi-eye' : 'mdi-eye-off'"
                            :type="show2 ? 'text' : 'password'"
                            name="input-10-1"
                            label="비밀번호 확인"
                            counter
                            @click:append="show2 = !show2"
                            :error-messages="errors"
                    ></v-text-field>
                    </validation-provider>
                    <!-- 약관동의 -->
                    <!-- <validation-provider
                    :rules="{
                            required:true,}"
                    >
                    <v-checkbox
                    v-model="checkbox"
                    label="사이트 이용 약관 동의"
                    ></v-checkbox>
                    </validation-provider> -->

                    <!-- <v-btn :disabled="!valid" color="success" class="mr-4" @click="validate">Validate</v-btn>

                    <v-btn color="error" class="mr-4" @click="reset">Reset Form</v-btn>

                    <v-btn color="warning" @click="resetValidation">Reset Validation</v-btn> -->

                <v-divider></v-divider>

                <v-card-actions>
                <v-spacer></v-spacer>
                <v-btn color="primary" type="submit" :disabled="invalid">확인</v-btn>
                <v-btn color="primary" @click="dialog2 = false">취소</v-btn>
                </v-card-actions>
                </v-form>
                </validation-observer>
                </v-card-text>
            </v-card>
            </v-dialog>
        </v-btn>
    </div>


    
</template>
 
<script>
import axios from 'axios'
export default {
  name: 'main-header',

    data () {
        return {
                dialog: false,
                dialog2: false,
                show1: false,
                show2: false,
                email: '',
                password: '',
                name: '',
                joinEmail: '',
                joinPassword: '',
                checkPassword: '',
                remember: false,
                authEmail: '',
                authName: '',
        }
    },
    created(){
        //  쿠키 정보를 읽어오는 부분
    var vm = this;
    axios.get('/auth/info')
        .then(res => {
        console.log("front :: " , res);
        vm = res.data;
        this.authName = vm.name;
        this.authEmail = vm.email;
        })
        .catch(err => {
        console.log(err);
        })
    },
    methods: {    
        mdUp () {
            this.dialog = true
        },
        mdUp2 () {
            this.dialog2 = true
        },
        postData() {
            this.dialog2 = false // dialog 창닫기
            // 모든 검증을 통과한 경우 result = true 
            this.$refs.observer.validate().then(result => {
                if (result) {
                    axios.post('http://localhost:3000/api/register',{
                        name: this.name,
                        email: this.joinEmail,
                        password: this.joinPassword
                    })
                    .then((r) => {
                        console.log(r)
                    })
                    .catch((e) => {
                        console.log(e)
                    })
                }
            })
        },
        postLoginData() {
            this.dialog = false // dialog 창닫기
            axios.post('http://localhost:3000/api/login',{
                email: this.email,
                password: this.password,
                remember: this.remember
            })
            .then((r) => {
                // console.log(r.data)
                // alert(`안녕하세요${r.data}`)
                // console.log(r)
                // if (!r.data.success) return console.error(r.data.msg)
                // // localStorage.setItem('token', r.data.token)
                // // this.$store.commit('getToken')
                // this.$router.push('/').catch(()=>{});
                // this.$router.push('/') 
            })
            .catch((e) => {
                console.log(e)
            })
        },
        logOut () {
            // localStorage.removeItem('token')
            this.$store.commit('delToken')
            this.$router.push('/')
        }
  }
}
</script>
 
<style scoped>
</style>